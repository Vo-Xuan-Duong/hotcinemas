import{r as c,q as ne,aM as ye,F as o,s as y,j as e,d as D,e as h,C as R,g as w,aN as O,b as fe,i as be,f as p,M as U,I as F,aO as ve,S as f,p as M,T as Te,P as ke,x as $,y as Ce,_ as W}from"./index-bcuI966E.js";import{d as j}from"./dayjs.min-B6KFzVi6.js";import{R as De}from"./CheckCircleOutlined-Cm1v39Q0.js";import{F as Re}from"./Table-BovAFv33.js";import{R as Me}from"./PlusOutlined-WAyayBFJ.js";import{S}from"./index-COd8B_t3.js";import{T as E}from"./index-CJAnxsAG.js";import{D as Pe}from"./index-BexZ__8y.js";import{T as Se}from"./index-D3FvcYjb.js";import{R as J}from"./EditOutlined-ntD1OIry.js";import{P as Z}from"./index-BqnuXQlz.js";import{R as ee}from"./PauseCircleOutlined-CeSS54s7.js";import{R as Ie}from"./DeleteOutlined-CNMFFws8.js";import{R as Ye}from"./StopOutlined-YHg61arC.js";import{R as we}from"./ClockCircleOutlined-Cahcm4Ws.js";import"./addEventListener-CwuRzLNG.js";import"./DownOutlined-DeH2MZMn.js";import"./Pagination-KlOrN12m.js";import"./ClockCircleOutlined-CELcQ7Uv.js";var $e={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M855.7 210.8l-42.4-42.4a8.03 8.03 0 00-11.3 0L168.3 801.9a8.03 8.03 0 000 11.3l42.4 42.4c3.1 3.1 8.2 3.1 11.3 0L855.6 222c3.2-3 3.2-8.1.1-11.2zM304 448c79.4 0 144-64.6 144-144s-64.6-144-144-144-144 64.6-144 144 64.6 144 144 144zm0-216c39.7 0 72 32.3 72 72s-32.3 72-72 72-72-32.3-72-72 32.3-72 72-72zm416 344c-79.4 0-144 64.6-144 144s64.6 144 144 144 144-64.6 144-144-64.6-144-144-144zm0 216c-39.7 0-72-32.3-72-72s32.3-72 72-72 72 32.3 72 72-32.3 72-72 72z"}}]},name:"percentage",theme:"outlined"};function B(){return B=Object.assign?Object.assign.bind():function(i){for(var l=1;l<arguments.length;l++){var m=arguments[l];for(var x in m)Object.prototype.hasOwnProperty.call(m,x)&&(i[x]=m[x])}return i},B.apply(this,arguments)}const Ve=(i,l)=>c.createElement(ne,B({},i,{ref:l,icon:ye})),ze=c.forwardRef(Ve);function N(){return N=Object.assign?Object.assign.bind():function(i){for(var l=1;l<arguments.length;l++){var m=arguments[l];for(var x in m)Object.prototype.hasOwnProperty.call(m,x)&&(i[x]=m[x])}return i},N.apply(this,arguments)}const He=(i,l)=>c.createElement(ne,N({},i,{ref:l,icon:$e})),te=c.forwardRef(He),{Text:P}=Te,{Option:V}=S,{TextArea:Le}=F,{RangePicker:Oe}=Pe,at=()=>{const[i,l]=c.useState([]),[m,x]=c.useState([]),[_,se]=c.useState([]),[G,I]=c.useState(!1),[ae,T]=c.useState(!1),[g,q]=c.useState(null),[b]=o.useForm(),[z,ie]=c.useState("all"),[le,H]=c.useState(!1),[s,K]=c.useState(null),[Y,re]=c.useState({totalPromotions:0,activePromotions:0,totalUsage:0,totalSavings:0}),L=[{value:"percentage",label:"Giảm theo %",icon:e.jsx(te,{})},{value:"fixed",label:"Giảm số tiền cố định",icon:e.jsx(O,{})},{value:"buy_x_get_y",label:"Mua X tặng Y",icon:e.jsx(O,{})}],k={active:{label:"Đang hoạt động",color:"success",icon:e.jsx(W,{})},paused:{label:"Tạm dừng",color:"warning",icon:e.jsx(ee,{})},scheduled:{label:"Chờ kích hoạt",color:"processing",icon:e.jsx(we,{})},expired:{label:"Hết hạn",color:"error",icon:e.jsx(Ye,{})}},A=[{value:"monday",label:"Thứ 2"},{value:"tuesday",label:"Thứ 3"},{value:"wednesday",label:"Thứ 4"},{value:"thursday",label:"Thứ 5"},{value:"friday",label:"Thứ 6"},{value:"saturday",label:"Thứ 7"},{value:"sunday",label:"Chủ nhật"}];c.useEffect(()=>{oe()},[]);const oe=async()=>{try{I(!0);const[t,n,a]=await Promise.all([fetch("/data/promotions.json"),fetch("/src/data/movies.json"),fetch("/src/data/cinemas.json")]),u=await t.json(),v=await n.json(),d=await a.json();l(u),x(v),se(d),C(u)}catch(t){y.error("Lỗi khi tải dữ liệu khuyến mãi"),console.error("Error loading data:",t)}finally{I(!1)}},C=t=>{const n=t.length,a=t.filter(d=>d.status==="active").length,u=t.reduce((d,r)=>d+r.usedCount,0),v=t.reduce((d,r)=>r.type==="fixed"?d+r.discount*r.usedCount:r.type==="percentage"?d+r.minAmount*r.discount/100*r.usedCount:d,0);re({totalPromotions:n,activePromotions:a,totalUsage:u,totalSavings:v})},ce=()=>{q(null),b.resetFields(),b.setFieldsValue({type:"percentage",status:"active",usageLimit:100,discount:10,minAmount:5e4}),T(!0)},Q=t=>{q(t),b.setFieldsValue({...t,dateRange:[j(t.startDate),j(t.endDate)],timeRange:t.timeRange?[j(t.timeRange.start,"HH:mm"),j(t.timeRange.end,"HH:mm")]:null}),T(!0)},de=async t=>{try{I(!0);const{dateRange:n,timeRange:a,...u}=t,v={...u,startDate:n[0].format("YYYY-MM-DD"),endDate:n[1].format("YYYY-MM-DD"),timeRange:a?{start:a[0].format("HH:mm"),end:a[1].format("HH:mm")}:null,createdDate:g?g.createdDate:new Date().toISOString(),createdBy:"admin",usedCount:g?g.usedCount:0};if(g){const d=i.map(r=>r.id===g.id?{...v,id:g.id}:r);l(d),C(d),y.success("Cập nhật khuyến mãi thành công")}else{const d={...v,id:Math.max(...i.map(je=>je.id))+1},r=[...i,d];l(r),C(r),y.success("Tạo khuyến mãi thành công")}T(!1),b.resetFields()}catch(n){y.error("Có lỗi xảy ra khi lưu khuyến mãi"),console.error("Error saving promotion:",n)}finally{I(!1)}},he=t=>{const n=i.filter(a=>a.id!==t.id);l(n),C(n),y.success("Xóa khuyến mãi thành công")},me=t=>{const n=t.status==="active"?"paused":"active",a=i.map(u=>u.id===t.id?{...u,status:n}:u);l(a),C(a),y.success(`${n==="active"?"Kích hoạt":"Tạm dừng"} khuyến mãi thành công`)},ue=t=>{navigator.clipboard.writeText(t),y.success("Đã sao chép mã khuyến mãi")},pe=t=>{K(t),H(!0)},X=()=>{H(!1),K(null)},xe=()=>z==="all"?i:i.filter(t=>t.status===z),ge=[{title:"Tên khuyến mãi",dataIndex:"name",key:"name",render:(t,n)=>e.jsxs(f,{direction:"vertical",size:"small",children:[e.jsx("strong",{children:t}),e.jsxs(f,{children:[e.jsx(M,{color:"blue",children:n.code}),e.jsx(p,{size:"small",icon:e.jsx(ze,{}),onClick:()=>ue(n.code)})]})]})},{title:"Loại & Giá trị",key:"discount",render:(t,n)=>e.jsxs(f,{direction:"vertical",size:"small",children:[e.jsx(M,{color:n.type==="percentage"?"green":"orange",children:L.find(a=>a.value===n.type)?.label}),e.jsx(P,{strong:!0,children:n.type==="percentage"?`${n.discount}%`:n.type==="fixed"?`${n.discount.toLocaleString("vi-VN")}đ`:`Mua ${n.buyQuantity} tặng ${n.getQuantity}`})]})},{title:"Thời gian",key:"period",render:(t,n)=>e.jsxs(f,{direction:"vertical",size:"small",children:[e.jsx(P,{children:j(n.startDate).format("DD/MM/YYYY")}),e.jsx(P,{type:"secondary",children:"đến"}),e.jsx(P,{children:j(n.endDate).format("DD/MM/YYYY")})]})},{title:"Trạng thái",dataIndex:"status",key:"status",render:t=>{const n=k[t];return e.jsx(M,{color:n.color,icon:n.icon,children:n.label})}},{title:"Sử dụng",key:"usage",render:(t,n)=>{const a=n.usedCount/n.usageLimit*100;return e.jsxs(f,{direction:"vertical",size:"small",style:{minWidth:120},children:[e.jsxs(P,{children:[n.usedCount,"/",n.usageLimit]}),e.jsx(ke,{percent:a,size:"small",status:a>=90?"exception":a>=70?"active":"normal",showInfo:!1})]})}},{title:"Thao tác",key:"actions",align:"center",render:(t,n)=>e.jsxs(f,{children:[e.jsx($,{title:"Xem chi tiết",children:e.jsx(p,{icon:e.jsx(Ce,{}),size:"small",onClick:()=>pe(n)})}),e.jsx($,{title:"Chỉnh sửa",children:e.jsx(p,{icon:e.jsx(J,{}),size:"small",onClick:()=>Q(n)})}),e.jsx(Z,{title:n.status==="active"?"Bạn có chắc muốn tạm dừng khuyến mãi này?":"Bạn có chắc muốn kích hoạt khuyến mãi này?",onConfirm:()=>me(n),okText:n.status==="active"?"Tạm dừng":"Kích hoạt",cancelText:"Hủy",children:e.jsx($,{title:n.status==="active"?"Tạm dừng":"Kích hoạt",children:e.jsx(p,{icon:n.status==="active"?e.jsx(ee,{}):e.jsx(W,{}),size:"small",type:n.status==="active"?"default":"primary"})})}),e.jsx(Z,{title:"Bạn có chắc chắn muốn xóa khuyến mãi này?",onConfirm:()=>he(n),okText:"Xóa",cancelText:"Hủy",children:e.jsx($,{title:"Xóa",children:e.jsx(p,{icon:e.jsx(Ie,{}),size:"small",danger:!0})})})]})}];return e.jsxs("div",{className:"promotions-page",children:[e.jsxs(D,{gutter:16,style:{marginBottom:24},children:[e.jsx(h,{span:6,children:e.jsx(R,{children:e.jsx(w,{title:"Tổng số khuyến mãi",value:Y.totalPromotions,prefix:e.jsx(O,{}),valueStyle:{color:"#1890ff"}})})}),e.jsx(h,{span:6,children:e.jsx(R,{children:e.jsx(w,{title:"Đang hoạt động",value:Y.activePromotions,prefix:e.jsx(De,{}),valueStyle:{color:"#52c41a"}})})}),e.jsx(h,{span:6,children:e.jsx(R,{children:e.jsx(w,{title:"Lượt sử dụng",value:Y.totalUsage,prefix:e.jsx(fe,{}),valueStyle:{color:"#722ed1"}})})}),e.jsx(h,{span:6,children:e.jsx(R,{children:e.jsx(w,{title:"Tổng tiết kiệm",value:Y.totalSavings,prefix:e.jsx(te,{}),suffix:"đ",valueStyle:{color:"#fa8c16"},formatter:t=>t.toLocaleString("vi-VN")})})})]}),e.jsxs(R,{title:"Danh sách khuyến mãi",extra:e.jsx(p,{type:"primary",icon:e.jsx(Me,{}),onClick:ce,children:"Tạo khuyến mãi"}),children:[e.jsx(be,{activeKey:z,onChange:ie,style:{marginBottom:16},items:[{key:"all",label:"Tất cả"},{key:"active",label:"Đang hoạt động"},{key:"paused",label:"Tạm dừng"},{key:"scheduled",label:"Chờ kích hoạt"},{key:"expired",label:"Hết hạn"}]}),e.jsx(Re,{columns:ge,dataSource:xe(),rowKey:"id",loading:G,pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`Tổng ${t} khuyến mãi`}})]}),e.jsx(U,{title:g?"Chỉnh sửa khuyến mãi":"Tạo khuyến mãi mới",open:ae,onCancel:()=>T(!1),footer:null,width:800,children:e.jsxs(o,{form:b,layout:"vertical",onFinish:de,children:[e.jsxs(D,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(o.Item,{name:"name",label:"Tên khuyến mãi",rules:[{required:!0,message:"Vui lòng nhập tên khuyến mãi"}],children:e.jsx(F,{placeholder:"VD: Giảm 20% vé cuối tuần"})})}),e.jsx(h,{span:12,children:e.jsx(o.Item,{name:"code",label:"Mã khuyến mãi",rules:[{required:!0,message:"Vui lòng nhập mã khuyến mãi"}],children:e.jsx(F,{placeholder:"VD: WEEKEND20",style:{textTransform:"uppercase"}})})})]}),e.jsx(o.Item,{name:"description",label:"Mô tả",rules:[{required:!0,message:"Vui lòng nhập mô tả"}],children:e.jsx(Le,{rows:3,placeholder:"Mô tả chi tiết về khuyến mãi..."})}),e.jsxs(D,{gutter:16,children:[e.jsx(h,{span:8,children:e.jsx(o.Item,{name:"type",label:"Loại khuyến mãi",rules:[{required:!0,message:"Vui lòng chọn loại"}],children:e.jsx(S,{children:L.map(t=>e.jsxs(V,{value:t.value,children:[t.icon," ",t.label]},t.value))})})}),e.jsx(h,{span:8,children:e.jsx(o.Item,{name:"discount",label:"Giá trị giảm",rules:[{required:!0,message:"Vui lòng nhập giá trị"}],children:e.jsx(E,{min:0,style:{width:"100%"},formatter:t=>b.getFieldValue("type")==="percentage"?`${t}%`:`${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t.replace(/\$\s?|(,*)/g,"").replace("%","")})})}),e.jsx(h,{span:8,children:e.jsx(o.Item,{name:"status",label:"Trạng thái",rules:[{required:!0,message:"Vui lòng chọn trạng thái"}],children:e.jsx(S,{children:Object.entries(k).map(([t,n])=>e.jsxs(V,{value:t,children:[n.icon," ",n.label]},t))})})})]}),e.jsxs(D,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(o.Item,{name:"minAmount",label:"Giá trị đơn tối thiểu",children:e.jsx(E,{min:0,style:{width:"100%"},formatter:t=>`${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t.replace(/\$\s?|(,*)/g,""),addonAfter:"đ"})})}),e.jsx(h,{span:12,children:e.jsx(o.Item,{name:"usageLimit",label:"Giới hạn sử dụng",children:e.jsx(E,{min:1,style:{width:"100%"}})})})]}),e.jsx(o.Item,{name:"dateRange",label:"Thời gian áp dụng",rules:[{required:!0,message:"Vui lòng chọn thời gian"}],children:e.jsx(Oe,{style:{width:"100%"},format:"DD/MM/YYYY"})}),e.jsx(o.Item,{name:"applicableDays",label:"Ngày trong tuần áp dụng",children:e.jsx(ve.Group,{options:A})}),e.jsx(o.Item,{name:"timeRange",label:"Khung giờ áp dụng (tùy chọn)",children:e.jsx(Se.RangePicker,{format:"HH:mm",style:{width:"100%"}})}),e.jsxs(D,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(o.Item,{name:"applicableMovies",label:"Phim áp dụng (để trống = tất cả)",children:e.jsx(S,{mode:"multiple",placeholder:"Chọn phim",children:m.map(t=>e.jsx(V,{value:t.id,children:t.title},t.id))})})}),e.jsx(h,{span:12,children:e.jsx(o.Item,{name:"applicableCinemas",label:"Rạp áp dụng (để trống = tất cả)",children:e.jsx(S,{mode:"multiple",placeholder:"Chọn rạp",children:_.map(t=>e.jsx(V,{value:t.id,children:t.name},t.id))})})})]}),e.jsxs(f,{style:{width:"100%",justifyContent:"flex-end"},children:[e.jsx(p,{onClick:()=>T(!1),children:"Hủy"}),e.jsx(p,{type:"primary",htmlType:"submit",loading:G,children:g?"Cập nhật":"Tạo khuyến mãi"})]})]})}),e.jsx(U,{title:"Chi tiết khuyến mãi",open:le,onCancel:X,width:600,footer:[e.jsx(p,{onClick:X,children:"Đóng"},"close"),e.jsx(p,{type:"primary",icon:e.jsx(J,{}),onClick:()=>{H(!1),Q(s)},children:"Chỉnh sửa"},"edit")],children:s&&e.jsxs("div",{children:[e.jsx("h2",{children:s.name}),e.jsxs("p",{children:[e.jsx("b",{children:"Mã khuyến mãi:"})," ",e.jsx(M,{color:"blue",children:s.code})]}),e.jsxs("p",{children:[e.jsx("b",{children:"Mô tả:"})," ",s.description]}),e.jsxs("p",{children:[e.jsx("b",{children:"Loại:"})," ",L.find(t=>t.value===s.type)?.label]}),e.jsxs("p",{children:[e.jsx("b",{children:"Giá trị:"})," ",s.type==="percentage"?`${s.discount}%`:s.type==="fixed"?`${s.discount.toLocaleString("vi-VN")}đ`:`Mua ${s.buyQuantity} tặng ${s.getQuantity}`]}),e.jsxs("p",{children:[e.jsx("b",{children:"Thời gian áp dụng:"})," ",j(s.startDate).format("DD/MM/YYYY")," - ",j(s.endDate).format("DD/MM/YYYY")]}),e.jsxs("p",{children:[e.jsx("b",{children:"Trạng thái:"})," ",e.jsx(M,{color:k[s.status].color,icon:k[s.status].icon,children:k[s.status].label})]}),e.jsxs("p",{children:[e.jsx("b",{children:"Lượt sử dụng:"})," ",s.usedCount,"/",s.usageLimit]}),e.jsxs("p",{children:[e.jsx("b",{children:"Ngày tạo:"})," ",s.createdDate?j(s.createdDate).format("DD/MM/YYYY HH:mm"):""]}),e.jsxs("p",{children:[e.jsx("b",{children:"Người tạo:"})," ",s.createdBy]}),e.jsxs("p",{children:[e.jsx("b",{children:"Áp dụng cho phim:"})," ",s.applicableMovies&&s.applicableMovies.length>0?s.applicableMovies.map(t=>m.find(n=>n.id===t)?.title).join(", "):"Tất cả"]}),e.jsxs("p",{children:[e.jsx("b",{children:"Áp dụng cho rạp:"})," ",s.applicableCinemas&&s.applicableCinemas.length>0?s.applicableCinemas.map(t=>_.find(n=>n.id===t)?.name).join(", "):"Tất cả"]}),e.jsxs("p",{children:[e.jsx("b",{children:"Ngày trong tuần áp dụng:"})," ",s.applicableDays&&s.applicableDays.length>0?s.applicableDays.map(t=>A.find(n=>n.value===t)?.label).join(", "):"Tất cả"]}),e.jsxs("p",{children:[e.jsx("b",{children:"Khung giờ áp dụng:"})," ",s.timeRange?`${s.timeRange.start} - ${s.timeRange.end}`:"Cả ngày"]})]})})]})};export{at as default};
