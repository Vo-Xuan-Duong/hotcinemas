import{r as c,q as re,F as a,j as e,aC as de,C as S,g as he,T as ue,f as m,i as me,a7 as pe,E as xe,p as k,S as D,d as _,e as g,P as ge,B as je,M as K,I as M,y as fe,s as j}from"./index-bcuI966E.js";import{d as $}from"./dayjs.min-B6KFzVi6.js";import{R as ye}from"./ClockCircleOutlined-Cahcm4Ws.js";import{R as be}from"./CheckCircleOutlined-Cm1v39Q0.js";import{R as P}from"./PlusOutlined-WAyayBFJ.js";import{F as q}from"./Table-BovAFv33.js";import{R as E}from"./EditOutlined-ntD1OIry.js";import{P as z}from"./index-BqnuXQlz.js";import{R as A}from"./DeleteOutlined-CNMFFws8.js";import{L as Q}from"./index-B6-RBrWM.js";import{S as b}from"./index-COd8B_t3.js";import{D as Te}from"./index-BexZ__8y.js";import"./ClockCircleOutlined-CELcQ7Uv.js";import"./addEventListener-CwuRzLNG.js";import"./DownOutlined-DeH2MZMn.js";import"./Pagination-KlOrN12m.js";var ve={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M931.4 498.9L94.9 79.5c-3.4-1.7-7.3-2.1-11-1.2a15.99 15.99 0 00-11.7 19.3l86.2 352.2c1.3 5.3 5.2 9.6 10.4 11.3l147.7 50.7-147.6 50.7c-5.2 1.8-9.1 6-10.3 11.3L72.2 926.5c-.9 3.7-.5 7.6 1.2 10.9 3.9 7.9 13.5 11.1 21.5 7.2l836.5-417c3.1-1.5 5.6-4.1 7.2-7.1 3.9-8 .7-17.6-7.2-21.6zM170.8 826.3l50.3-205.6 295.2-101.3c2.3-.8 4.2-2.6 5-5 1.4-4.2-.8-8.7-5-10.2L221.1 403 171 198.2l628 314.9-628.2 313.2z"}}]},name:"send",theme:"outlined"};function F(){return F=Object.assign?Object.assign.bind():function(i){for(var r=1;r<arguments.length;r++){var f=arguments[r];for(var d in f)Object.prototype.hasOwnProperty.call(f,d)&&(i[d]=f[d])}return i},F.apply(this,arguments)}const we=(i,r)=>c.createElement(re,F({},i,{ref:r,icon:ve})),H=c.forwardRef(we),o={"notifications-container":"_notifications-container_1iw7i_1","notifications-table":"_notifications-table_1iw7i_94","notifications-card":"_notifications-card_1iw7i_102","notifications-tabs":"_notifications-tabs_1iw7i_111","notifications-modal":"_notifications-modal_1iw7i_128","notifications-form":"_notifications-form_1iw7i_154","notifications-button":"_notifications-button_1iw7i_179"},{Title:X,Text:Ie}=ue,{Option:s}=b,{TextArea:J}=M,qe=()=>{const[i,r]=c.useState([]),[f,d]=c.useState(!1),[l,T]=c.useState("view"),[p,y]=c.useState(null),[h]=a.useForm(),[W,L]=c.useState(!0),[v,N]=c.useState([]),[G,w]=c.useState(!1),[I,V]=c.useState("create"),[R,C]=c.useState(null),[x]=a.useForm();c.useEffect(()=>{fetch("/data/notifications.json").then(t=>t.json()).then(t=>{r(t),L(!1)}).catch(()=>{r([]),L(!1)})},[]);const U=()=>{T("create"),y(null),h.resetFields(),d(!0)},Y=()=>{h.validateFields().then(t=>{if(l==="create"){const n={...t,id:Date.now(),schedule:t.schedule?t.schedule.toISOString():new Date().toISOString(),createdAt:new Date().toLocaleString(),sentTo:0,opened:0,status:"Chưa gửi"};r([n,...i]),j.success("Tạo thông báo thành công!")}else if(l==="edit"&&p){const n=i.map(u=>u.id===p.id?{...u,...t,schedule:t.schedule&&t.schedule.toISOString?t.schedule.toISOString():u.schedule}:u);r(n),j.success("Cập nhật thông báo thành công!")}d(!1),y(null),h.resetFields()}).catch(t=>{console.log("Validate Failed:",t)})},O=()=>{d(!1),y(null),h.resetFields()},Z=[{title:"Tiêu đề",dataIndex:"title",key:"title",render:t=>e.jsx("a",{children:t})},{title:"Nội dung",dataIndex:"content",key:"content"},{title:"Loại thông báo",dataIndex:"type",key:"type",render:t=>e.jsx(k,{color:"blue",children:t})},{title:"Mức độ ưu tiên",dataIndex:"priority",key:"priority",render:t=>e.jsx(k,{color:t==="Khẩn cấp"?"red":t==="Quan trọng"?"orange":"green",children:t})},{title:"Thời gian gửi",dataIndex:"schedule",key:"schedule",render:t=>e.jsx("span",{children:new Date(t).toLocaleString()})},{title:"Hành động",key:"action",render:(t,n)=>e.jsxs(D,{size:"middle",children:[e.jsx(m,{icon:e.jsx(fe,{}),onClick:()=>ee(n)}),e.jsx(m,{icon:e.jsx(E,{}),onClick:()=>te(n)}),e.jsx(z,{title:"Bạn có chắc chắn muốn xóa thông báo này?",onConfirm:()=>ne(n.id),okText:"Có",cancelText:"Không",children:e.jsx(m,{icon:e.jsx(A,{})})})]})}],ee=t=>{y(t),T("view"),h.setFieldsValue({...t,schedule:t.schedule?$(t.schedule):null}),d(!0)},te=t=>{y(t),T("edit"),h.setFieldsValue({...t,schedule:t.schedule?$(t.schedule):null}),d(!0)},ne=t=>{r(i.filter(n=>n.id!==t)),j.success("Xóa thông báo thành công!")},ie=()=>{V("create"),C(null),x.resetFields(),w(!0)},se=t=>{C(t),V("edit"),x.setFieldsValue(t),w(!0)},le=t=>{N(v.filter(n=>n.id!==t)),j.success("Xóa template thành công!")},ae=()=>{x.validateFields().then(t=>{if(I==="create"){const n={...t,id:Date.now()};N([n,...v]),j.success("Tạo template thành công!")}else if(I==="edit"&&R){const n=v.map(u=>u.id===R.id?{...u,...t}:u);N(n),j.success("Cập nhật template thành công!")}w(!1),C(null),x.resetFields()})},oe=()=>{w(!1),C(null),x.resetFields()},ce=t=>{T("create"),d(!0),h.setFieldsValue({...t,schedule:null})},B=[{title:"Tổng số thông báo",value:i.length,icon:e.jsx(de,{})},{title:"Thông báo đã gửi",value:i.filter(t=>t.status==="Đã gửi").length,icon:e.jsx(H,{})},{title:"Thông báo chưa gửi",value:i.filter(t=>t.status==="Chưa gửi").length,icon:e.jsx(ye,{})},{title:"Tỷ lệ mở",value:i.length>0?Math.round(i.reduce((t,n)=>t+(n.opened||0),0)/i.reduce((t,n)=>t+(n.sentTo||1),0)*100||0)+"%":"0%",icon:e.jsx(be,{})}];return e.jsxs("div",{className:o["notifications-container"],children:[e.jsx("div",{style:{display:"flex",gap:"16px",marginBottom:"24px"},children:B.map((t,n)=>e.jsx(S,{className:o["notifications-card"],style:{flex:1,minWidth:0},children:e.jsx(he,{title:t.title,value:t.value,prefix:t.icon})},n))}),e.jsxs(S,{className:o["notifications-card"],children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx(X,{level:4,style:{margin:0},children:"Danh sách thông báo"}),e.jsx(m,{type:"primary",icon:e.jsx(P,{}),onClick:U,className:o["notifications-button"],children:"Tạo thông báo"})]}),e.jsx(me,{defaultActiveKey:"all",className:o["notifications-tabs"],items:[{key:"all",label:"Tất cả",children:W?e.jsx(pe,{}):e.jsx(q,{columns:Z,dataSource:i,rowKey:"id",className:o["notifications-table"],pagination:{total:i.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(t,n)=>`${n[0]}-${n[1]} của ${t} thông báo`}})},{key:"templates",label:"Template",children:e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx(X,{level:4,style:{margin:0},children:"Danh sách template"}),e.jsx(m,{type:"primary",icon:e.jsx(P,{}),onClick:ie,className:o["notifications-button"],children:"Tạo template"})]}),e.jsx(q,{columns:[{title:"Tiêu đề",dataIndex:"title",key:"title"},{title:"Nội dung",dataIndex:"content",key:"content"},{title:"Loại",dataIndex:"type",key:"type",render:t=>e.jsx(k,{color:"blue",children:t})},{title:"Mức độ",dataIndex:"priority",key:"priority",render:t=>e.jsx(k,{color:t==="Khẩn cấp"?"red":t==="Quan trọng"?"orange":"green",children:t})},{title:"Hành động",key:"action",render:(t,n)=>e.jsxs(D,{size:"middle",children:[e.jsx(m,{icon:e.jsx(E,{}),onClick:()=>se(n)}),e.jsx(z,{title:"Bạn có chắc chắn muốn xóa template này?",onConfirm:()=>le(n.id),okText:"Có",cancelText:"Không",children:e.jsx(m,{icon:e.jsx(A,{})})}),e.jsx(m,{icon:e.jsx(H,{}),onClick:()=>ce(n),children:"Áp dụng"})]})}],dataSource:v,rowKey:"id",pagination:!1,locale:{emptyText:e.jsx(xe,{description:"Chưa có template nào"})}})]})},{key:"analytics",label:"Phân tích",children:e.jsx("div",{children:e.jsxs(_,{gutter:16,children:[e.jsx(g,{span:12,children:e.jsx(S,{title:"Tỷ lệ mở thông báo",className:o["notifications-card"],children:e.jsx(ge,{percent:parseInt(B[3].value),strokeColor:"#e50914"})})}),e.jsx(g,{span:12,children:e.jsx(S,{title:"Thống kê theo loại",className:o["notifications-card"],children:e.jsx(Q,{dataSource:["promotion","movie","maintenance","news"].map(t=>({type:t,count:i.filter(n=>n.type===t).length})),renderItem:t=>e.jsxs(Q.Item,{children:[e.jsx(Ie,{children:t.type}),e.jsx(je,{count:t.count,style:{backgroundColor:"#e50914"}})]})})})})]})})}]})]}),e.jsxs(K,{title:l==="view"?"Chi tiết thông báo":l==="edit"?"Chỉnh sửa thông báo":"Tạo thông báo mới",open:f,onOk:l==="view"?O:Y,onCancel:O,width:600,className:o["notifications-modal"],okText:l==="view"?"Đóng":"Lưu",cancelText:"Hủy",okButtonProps:l==="view"?{style:{display:"inline-block"}}:{},children:[e.jsxs(a,{form:h,layout:"vertical",className:o["notifications-form"],children:[e.jsx(a.Item,{name:"title",label:"Tiêu đề",rules:[{required:!0,message:"Vui lòng nhập tiêu đề!"}],children:e.jsx(M,{placeholder:"Nhập tiêu đề thông báo",disabled:l==="view"})}),e.jsx(a.Item,{name:"content",label:"Nội dung",rules:[{required:!0,message:"Vui lòng nhập nội dung!"}],children:e.jsx(J,{rows:4,placeholder:"Nhập nội dung thông báo",disabled:l==="view"})}),e.jsxs(_,{gutter:16,children:[e.jsx(g,{span:12,children:e.jsx(a.Item,{name:"type",label:"Loại thông báo",rules:[{required:!0,message:"Vui lòng chọn loại!"}],children:e.jsxs(b,{placeholder:"Chọn loại thông báo",disabled:l==="view",children:[e.jsx(s,{value:"promotion",children:"Khuyến mãi"}),e.jsx(s,{value:"movie",children:"Phim mới"}),e.jsx(s,{value:"maintenance",children:"Bảo trì"}),e.jsx(s,{value:"news",children:"Tin tức"})]})})}),e.jsx(g,{span:12,children:e.jsx(a.Item,{name:"priority",label:"Mức độ ưu tiên",rules:[{required:!0,message:"Vui lòng chọn mức độ!"}],children:e.jsxs(b,{placeholder:"Chọn mức độ ưu tiên",disabled:l==="view",children:[e.jsx(s,{value:"normal",children:"Bình thường"}),e.jsx(s,{value:"important",children:"Quan trọng"}),e.jsx(s,{value:"urgent",children:"Khẩn cấp"})]})})})]}),e.jsx(a.Item,{name:"schedule",label:"Lịch gửi",children:e.jsx(Te,{showTime:!0,placeholder:"Chọn thời gian gửi",style:{width:"100%"},disabled:l==="view"})})]}),l==="view"&&p&&e.jsxs("div",{style:{marginTop:24,color:"#8c8c8c",fontSize:14},children:[e.jsxs("div",{children:["Ngày tạo: ",p.createdAt]}),e.jsxs("div",{children:["Đã gửi: ",p.sentTo]}),e.jsxs("div",{children:["Đã mở: ",p.opened]}),e.jsxs("div",{children:["Trạng thái: ",p.status]})]})]}),e.jsx(K,{title:I==="edit"?"Chỉnh sửa template":"Tạo template mới",open:G,onOk:ae,onCancel:oe,width:600,className:o["notifications-modal"],okText:I==="edit"?"Cập nhật":"Tạo",cancelText:"Hủy",children:e.jsxs(a,{form:x,layout:"vertical",className:o["notifications-form"],children:[e.jsx(a.Item,{name:"title",label:"Tiêu đề",rules:[{required:!0,message:"Vui lòng nhập tiêu đề!"}],children:e.jsx(M,{placeholder:"Nhập tiêu đề template"})}),e.jsx(a.Item,{name:"content",label:"Nội dung",rules:[{required:!0,message:"Vui lòng nhập nội dung!"}],children:e.jsx(J,{rows:4,placeholder:"Nhập nội dung template"})}),e.jsxs(_,{gutter:16,children:[e.jsx(g,{span:12,children:e.jsx(a.Item,{name:"type",label:"Loại",rules:[{required:!0,message:"Vui lòng chọn loại!"}],children:e.jsxs(b,{placeholder:"Chọn loại",children:[e.jsx(s,{value:"promotion",children:"Khuyến mãi"}),e.jsx(s,{value:"movie",children:"Phim mới"}),e.jsx(s,{value:"maintenance",children:"Bảo trì"}),e.jsx(s,{value:"news",children:"Tin tức"})]})})}),e.jsx(g,{span:12,children:e.jsx(a.Item,{name:"priority",label:"Mức độ",rules:[{required:!0,message:"Vui lòng chọn mức độ!"}],children:e.jsxs(b,{placeholder:"Chọn mức độ",children:[e.jsx(s,{value:"normal",children:"Bình thường"}),e.jsx(s,{value:"important",children:"Quan trọng"}),e.jsx(s,{value:"urgent",children:"Khẩn cấp"})]})})})]})]})})]})};export{qe as default};
