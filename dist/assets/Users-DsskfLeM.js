import{r as h,F as i,j as e,f as c,d as x,e as l,C as p,g as b,aH as ne,I as m,M as $,S as V,A as B,b as N,y as se,p as U,s as w}from"./index-bcuI966E.js";import{u as le}from"./users-DVp3fnkH.js";import{R as ie}from"./PlusOutlined-WAyayBFJ.js";import{R as q}from"./CheckCircleOutlined-Cm1v39Q0.js";import{R}from"./CrownOutlined-BJUwjmND.js";import{S as j}from"./index-COd8B_t3.js";import{F as ae}from"./Table-BovAFv33.js";import{T as E}from"./index-CJAnxsAG.js";import{D as u}from"./index-C9OcwkKB.js";import{R as re}from"./EditOutlined-ntD1OIry.js";import{P as D}from"./index-BqnuXQlz.js";import{R as oe}from"./DeleteOutlined-CNMFFws8.js";import{R as H}from"./StopOutlined-YHg61arC.js";import"./DownOutlined-DeH2MZMn.js";import"./addEventListener-CwuRzLNG.js";import"./Pagination-KlOrN12m.js";const{Option:s}=j,Ce=()=>{const[o,y]=h.useState(le),[A,I]=h.useState(!1),[P,S]=h.useState(!1),[Q,F]=h.useState(!1),[a,g]=h.useState(null),[d]=i.useForm(),[v,X]=h.useState(""),[T,O]=h.useState("all"),[k,_]=h.useState("all"),C=h.useMemo(()=>({total:o.length,active:o.filter(t=>t.status==="active").length,inactive:o.filter(t=>t.status==="inactive").length,suspended:o.filter(t=>t.status==="suspended").length,admins:o.filter(t=>t.role==="admin").length,vips:o.filter(t=>t.role==="vip").length,moderators:o.filter(t=>t.role==="moderator").length}),[o]),z=h.useMemo(()=>o.filter(n=>{const t=n.fullName?.toLowerCase().includes(v.toLowerCase())||n.email?.toLowerCase().includes(v.toLowerCase())||n.username?.toLowerCase().includes(v.toLowerCase()),r=T==="all"||n.status===T,f=k==="all"||n.role===k;return t&&r&&f}),[o,v,T,k]),G=n=>{const t={id:Date.now(),...n,createdAt:new Date().toISOString(),lastLogin:null,totalBookings:0,totalSpent:0,avatar:"https://image.tmdb.org/t/p/w500/kbNyaREVYRZPfGHdQHBxaxU0DVv.jpg"};y([...o,t]),I(!1),d.resetFields(),w.success("Thêm người dùng thành công!")},J=n=>{const t=o.map(r=>r.id===a.id?{...r,...n}:r);y(t),S(!1),g(null),d.resetFields(),w.success("Cập nhật người dùng thành công!")},W=n=>{const t=o.filter(r=>r.id!==n);y(t),w.success("Xóa người dùng thành công!")},M=(n,t)=>{const r=o.map(f=>f.id===n?{...f,status:t}:f);y(r),w.success(`Đã ${t==="active"?"kích hoạt":t==="suspended"?"tạm khóa":"vô hiệu hóa"} người dùng!`)},Y=()=>{I(!0),d.resetFields()},Z=n=>{g(n),S(!0),d.setFieldsValue(n)},ee=n=>{g(n),F(!0)},L=n=>{const t={active:{color:"success",text:"Hoạt động",icon:e.jsx(q,{})},inactive:{color:"default",text:"Không hoạt động",icon:e.jsx(H,{})},suspended:{color:"error",text:"Tạm khóa",icon:e.jsx(H,{})}},r=t[n]||t.inactive;return e.jsx(U,{color:r.color,icon:r.icon,children:r.text})},K=n=>{const t={admin:{color:"red",text:"Quản trị viên",icon:e.jsx(R,{})},moderator:{color:"blue",text:"Kiểm duyệt viên",icon:e.jsx(N,{})},vip:{color:"gold",text:"VIP",icon:e.jsx(R,{})},user:{color:"green",text:"Người dùng",icon:e.jsx(N,{})}},r=t[n]||t.user;return e.jsx(U,{color:r.color,icon:r.icon,children:r.text})},te=[{title:"Avatar",dataIndex:"avatar",key:"avatar",width:80,render:(n,t)=>e.jsx(B,{src:n,icon:e.jsx(N,{}),size:50,alt:t.fullName})},{title:"Thông tin",key:"info",render:(n,t)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:t.fullName}),e.jsxs("div",{style:{color:"#666",fontSize:"12px"},children:["@",t.username]}),e.jsx("div",{style:{color:"#666",fontSize:"12px"},children:t.email})]})},{title:"Số điện thoại",dataIndex:"phone",key:"phone"},{title:"Vai trò",dataIndex:"role",key:"role",render:K,filters:[{text:"Quản trị viên",value:"admin"},{text:"Kiểm duyệt viên",value:"moderator"},{text:"VIP",value:"vip"},{text:"Người dùng",value:"user"}],onFilter:(n,t)=>t.role===n},{title:"Trạng thái",dataIndex:"status",key:"status",render:L,filters:[{text:"Hoạt động",value:"active"},{text:"Không hoạt động",value:"inactive"},{text:"Tạm khóa",value:"suspended"}],onFilter:(n,t)=>t.status===n},{title:"Tổng đặt vé",dataIndex:"totalBookings",key:"totalBookings",sorter:(n,t)=>n.totalBookings-t.totalBookings},{title:"Tổng chi tiêu",dataIndex:"totalSpent",key:"totalSpent",render:n=>`${n?.toLocaleString("vi-VN")} ₫`,sorter:(n,t)=>n.totalSpent-t.totalSpent},{title:"Thao tác",key:"actions",width:200,render:(n,t)=>e.jsxs(V,{size:"small",children:[e.jsx(c,{type:"link",icon:e.jsx(se,{}),onClick:()=>ee(t),size:"small",children:"Xem"}),e.jsx(c,{type:"link",icon:e.jsx(re,{}),onClick:()=>Z(t),size:"small",children:"Sửa"}),t.status==="active"?e.jsx(D,{title:"Tạm khóa người dùng này?",onConfirm:()=>M(t.id,"suspended"),okText:"Có",cancelText:"Không",children:e.jsx(c,{type:"link",danger:!0,size:"small",children:"Khóa"})}):e.jsx(D,{title:"Kích hoạt người dùng này?",onConfirm:()=>M(t.id,"active"),okText:"Có",cancelText:"Không",children:e.jsx(c,{type:"link",size:"small",children:"Kích hoạt"})}),e.jsx(D,{title:"Bạn có chắc chắn muốn xóa người dùng này?",onConfirm:()=>W(t.id),okText:"Có",cancelText:"Không",children:e.jsx(c,{type:"link",danger:!0,icon:e.jsx(oe,{}),size:"small",children:"Xóa"})})]})}];return e.jsxs("div",{className:"users-container",children:[e.jsxs("div",{className:"users-header",children:[e.jsx("h1",{children:"Quản lý người dùng"}),e.jsx(c,{type:"primary",icon:e.jsx(ie,{}),onClick:Y,size:"large",children:"Thêm người dùng"})]}),e.jsxs(x,{gutter:[16,16],className:"stats-row",children:[e.jsx(l,{xs:24,sm:12,md:6,children:e.jsx(p,{children:e.jsx(b,{title:"Tổng người dùng",value:C.total,prefix:e.jsx(ne,{}),valueStyle:{color:"#1890ff"}})})}),e.jsx(l,{xs:24,sm:12,md:6,children:e.jsx(p,{children:e.jsx(b,{title:"Đang hoạt động",value:C.active,prefix:e.jsx(q,{}),valueStyle:{color:"#52c41a"}})})}),e.jsx(l,{xs:24,sm:12,md:6,children:e.jsx(p,{children:e.jsx(b,{title:"VIP",value:C.vips,prefix:e.jsx(R,{}),valueStyle:{color:"#faad14"}})})}),e.jsx(l,{xs:24,sm:12,md:6,children:e.jsx(p,{children:e.jsx(b,{title:"Quản trị viên",value:C.admins,prefix:e.jsx(R,{}),valueStyle:{color:"#f5222d"}})})})]}),e.jsx(p,{className:"filter-card",children:e.jsxs(x,{gutter:[16,16],children:[e.jsx(l,{xs:24,md:8,children:e.jsx(m.Search,{placeholder:"Tìm kiếm theo tên, email, username...",value:v,onChange:n=>X(n.target.value),allowClear:!0})}),e.jsx(l,{xs:24,md:8,children:e.jsxs(j,{placeholder:"Lọc theo trạng thái",value:T,onChange:O,style:{width:"100%"},children:[e.jsx(s,{value:"all",children:"Tất cả trạng thái"}),e.jsx(s,{value:"active",children:"Hoạt động"}),e.jsx(s,{value:"inactive",children:"Không hoạt động"}),e.jsx(s,{value:"suspended",children:"Tạm khóa"})]})}),e.jsx(l,{xs:24,md:8,children:e.jsxs(j,{placeholder:"Lọc theo vai trò",value:k,onChange:_,style:{width:"100%"},children:[e.jsx(s,{value:"all",children:"Tất cả vai trò"}),e.jsx(s,{value:"admin",children:"Quản trị viên"}),e.jsx(s,{value:"moderator",children:"Kiểm duyệt viên"}),e.jsx(s,{value:"vip",children:"VIP"}),e.jsx(s,{value:"user",children:"Người dùng"})]})})]})}),e.jsx(p,{children:e.jsx(ae,{columns:te,dataSource:z,rowKey:"id",pagination:{total:z.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(n,t)=>`${t[0]}-${t[1]} của ${n} người dùng`},scroll:{x:1200}})}),e.jsx($,{title:"Thêm người dùng mới",open:A,onCancel:()=>{I(!1),d.resetFields()},footer:null,width:600,children:e.jsxs(i,{form:d,layout:"vertical",onFinish:G,children:[e.jsxs(x,{gutter:16,children:[e.jsx(l,{span:12,children:e.jsx(i.Item,{name:"username",label:"Tên đăng nhập",rules:[{required:!0,message:"Vui lòng nhập tên đăng nhập!"},{min:3,message:"Tên đăng nhập phải có ít nhất 3 ký tự!"}],children:e.jsx(m,{placeholder:"Nhập tên đăng nhập"})})}),e.jsx(l,{span:12,children:e.jsx(i.Item,{name:"fullName",label:"Họ và tên",rules:[{required:!0,message:"Vui lòng nhập họ và tên!"}],children:e.jsx(m,{placeholder:"Nhập họ và tên"})})})]}),e.jsxs(x,{gutter:16,children:[e.jsx(l,{span:12,children:e.jsx(i.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Vui lòng nhập email!"},{type:"email",message:"Email không hợp lệ!"}],children:e.jsx(m,{placeholder:"Nhập email"})})}),e.jsx(l,{span:12,children:e.jsx(i.Item,{name:"phone",label:"Số điện thoại",rules:[{required:!0,message:"Vui lòng nhập số điện thoại!"},{pattern:/^[0-9]{10,11}$/,message:"Số điện thoại không hợp lệ!"}],children:e.jsx(m,{placeholder:"Nhập số điện thoại"})})})]}),e.jsxs(x,{gutter:16,children:[e.jsx(l,{span:12,children:e.jsx(i.Item,{name:"role",label:"Vai trò",rules:[{required:!0,message:"Vui lòng chọn vai trò!"}],children:e.jsxs(j,{placeholder:"Chọn vai trò",children:[e.jsx(s,{value:"user",children:"Người dùng"}),e.jsx(s,{value:"vip",children:"VIP"}),e.jsx(s,{value:"moderator",children:"Kiểm duyệt viên"}),e.jsx(s,{value:"admin",children:"Quản trị viên"})]})})}),e.jsx(l,{span:12,children:e.jsx(i.Item,{name:"status",label:"Trạng thái",rules:[{required:!0,message:"Vui lòng chọn trạng thái!"}],initialValue:"active",children:e.jsxs(j,{placeholder:"Chọn trạng thái",children:[e.jsx(s,{value:"active",children:"Hoạt động"}),e.jsx(s,{value:"inactive",children:"Không hoạt động"}),e.jsx(s,{value:"suspended",children:"Tạm khóa"})]})})})]}),e.jsx(i.Item,{children:e.jsxs(V,{children:[e.jsx(c,{type:"primary",htmlType:"submit",children:"Thêm người dùng"}),e.jsx(c,{onClick:()=>{I(!1),d.resetFields()},children:"Hủy"})]})})]})}),e.jsx($,{title:"Chỉnh sửa người dùng",open:P,onCancel:()=>{S(!1),g(null),d.resetFields()},footer:null,width:600,children:e.jsxs(i,{form:d,layout:"vertical",onFinish:J,children:[e.jsxs(x,{gutter:16,children:[e.jsx(l,{span:12,children:e.jsx(i.Item,{name:"username",label:"Tên đăng nhập",rules:[{required:!0,message:"Vui lòng nhập tên đăng nhập!"},{min:3,message:"Tên đăng nhập phải có ít nhất 3 ký tự!"}],children:e.jsx(m,{placeholder:"Nhập tên đăng nhập"})})}),e.jsx(l,{span:12,children:e.jsx(i.Item,{name:"fullName",label:"Họ và tên",rules:[{required:!0,message:"Vui lòng nhập họ và tên!"}],children:e.jsx(m,{placeholder:"Nhập họ và tên"})})})]}),e.jsxs(x,{gutter:16,children:[e.jsx(l,{span:12,children:e.jsx(i.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Vui lòng nhập email!"},{type:"email",message:"Email không hợp lệ!"}],children:e.jsx(m,{placeholder:"Nhập email"})})}),e.jsx(l,{span:12,children:e.jsx(i.Item,{name:"phone",label:"Số điện thoại",rules:[{required:!0,message:"Vui lòng nhập số điện thoại!"},{pattern:/^[0-9]{10,11}$/,message:"Số điện thoại không hợp lệ!"}],children:e.jsx(m,{placeholder:"Nhập số điện thoại"})})})]}),e.jsxs(x,{gutter:16,children:[e.jsx(l,{span:12,children:e.jsx(i.Item,{name:"role",label:"Vai trò",rules:[{required:!0,message:"Vui lòng chọn vai trò!"}],children:e.jsxs(j,{placeholder:"Chọn vai trò",children:[e.jsx(s,{value:"user",children:"Người dùng"}),e.jsx(s,{value:"vip",children:"VIP"}),e.jsx(s,{value:"moderator",children:"Kiểm duyệt viên"}),e.jsx(s,{value:"admin",children:"Quản trị viên"})]})})}),e.jsx(l,{span:12,children:e.jsx(i.Item,{name:"status",label:"Trạng thái",rules:[{required:!0,message:"Vui lòng chọn trạng thái!"}],children:e.jsxs(j,{placeholder:"Chọn trạng thái",children:[e.jsx(s,{value:"active",children:"Hoạt động"}),e.jsx(s,{value:"inactive",children:"Không hoạt động"}),e.jsx(s,{value:"suspended",children:"Tạm khóa"})]})})})]}),e.jsxs(x,{gutter:16,children:[e.jsx(l,{span:12,children:e.jsx(i.Item,{name:"totalBookings",label:"Tổng số vé đã đặt",children:e.jsx(E,{min:0,style:{width:"100%"}})})}),e.jsx(l,{span:12,children:e.jsx(i.Item,{name:"totalSpent",label:"Tổng chi tiêu (VNĐ)",children:e.jsx(E,{min:0,formatter:n=>`${n}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),style:{width:"100%"}})})})]}),e.jsx(i.Item,{children:e.jsxs(V,{children:[e.jsx(c,{type:"primary",htmlType:"submit",children:"Cập nhật"}),e.jsx(c,{onClick:()=>{S(!1),g(null),d.resetFields()},children:"Hủy"})]})})]})}),e.jsx($,{title:"Chi tiết người dùng",open:Q,onCancel:()=>{F(!1),g(null)},footer:[e.jsx(c,{onClick:()=>{F(!1),g(null)},children:"Đóng"},"close")],width:700,children:a&&e.jsxs("div",{children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:24},children:[e.jsx(B,{src:a.avatar,size:80,icon:e.jsx(N,{})}),e.jsx("h2",{style:{margin:"16px 0 8px 0"},children:a.fullName}),e.jsxs(V,{children:[K(a.role),L(a.status)]})]}),e.jsxs(u,{bordered:!0,column:2,children:[e.jsx(u.Item,{label:"Tên đăng nhập",children:a.username}),e.jsx(u.Item,{label:"Email",children:a.email}),e.jsx(u.Item,{label:"Số điện thoại",children:a.phone}),e.jsx(u.Item,{label:"Vai trò",children:K(a.role)}),e.jsx(u.Item,{label:"Trạng thái",children:L(a.status)}),e.jsx(u.Item,{label:"Ngày tạo",children:new Date(a.createdAt).toLocaleDateString("vi-VN")}),e.jsx(u.Item,{label:"Lần đăng nhập cuối",children:a.lastLogin?new Date(a.lastLogin).toLocaleDateString("vi-VN")+" "+new Date(a.lastLogin).toLocaleTimeString("vi-VN"):"Chưa đăng nhập"}),e.jsx(u.Item,{label:"Tổng số vé đã đặt",children:e.jsxs("strong",{children:[a.totalBookings," vé"]})}),e.jsx(u.Item,{label:"Tổng chi tiêu",span:2,children:e.jsxs("strong",{style:{color:"#1890ff",fontSize:"16px"},children:[a.totalSpent?.toLocaleString("vi-VN")," ₫"]})})]})]})})]})};export{Ce as default};
