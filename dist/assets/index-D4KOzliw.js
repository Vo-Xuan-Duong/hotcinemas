import{r as h,F as j,j as e,d as T,e as r,C as c,g as k,t as B,b as F,I as Z,Q as ee,M as P,S as f,f as d,p as R,a1 as te,B as ne,y as se,s as z}from"./index-bcuI966E.js";import{b as le}from"./bookings-DFXbdP0l.js";import{c as ie}from"./cinemas-BvADCmeD.js";import{R as $}from"./CheckCircleOutlined-Cm1v39Q0.js";import{R as _}from"./DollarOutlined-CoSIG8gj.js";import{S as x}from"./index-COd8B_t3.js";import{F as ae}from"./Table-BovAFv33.js";import{D as s}from"./index-C9OcwkKB.js";import{R as oe}from"./EditOutlined-ntD1OIry.js";import{P as D}from"./index-BqnuXQlz.js";import{R as re}from"./DeleteOutlined-CNMFFws8.js";import{R as ce}from"./ExclamationCircleOutlined-CNDywDqf.js";import{R as he}from"./CloseCircleOutlined-BOFOa5Iq.js";import{R as de}from"./ClockCircleOutlined-Cahcm4Ws.js";import{D as me}from"./index-BexZ__8y.js";import"./DownOutlined-DeH2MZMn.js";import"./addEventListener-CwuRzLNG.js";import"./Pagination-KlOrN12m.js";import"./ClockCircleOutlined-CELcQ7Uv.js";import"./dayjs.min-B6KFzVi6.js";const{Option:l}=x,{RangePicker:Me}=me,Ve=()=>{const[o,b]=h.useState(le),[E,w]=h.useState(!1),[H,v]=h.useState(!1),[i,m]=h.useState(null),[p]=j.useForm(),[u,K]=h.useState(""),[y,X]=h.useState("all"),[S,W]=h.useState("all"),[C,q]=h.useState("all"),I=h.useMemo(()=>({total:o.length,confirmed:o.filter(t=>t.status==="confirmed").length,pending:o.filter(t=>t.status==="pending").length,cancelled:o.filter(t=>t.status==="cancelled").length,expired:o.filter(t=>t.status==="expired").length,totalRevenue:o.filter(t=>t.status==="confirmed").reduce((t,a)=>t+a.totalPrice,0),totalSeats:o.filter(t=>t.status==="confirmed").reduce((t,a)=>t+a.seats.length,0)}),[o]),N=h.useMemo(()=>o.filter(n=>{const t=n.userName?.toLowerCase().includes(u.toLowerCase())||n.movieTitle?.toLowerCase().includes(u.toLowerCase())||n.cinemaName?.toLowerCase().includes(u.toLowerCase())||n.customerInfo?.email?.toLowerCase().includes(u.toLowerCase()),a=y==="all"||n.status===y,g=S==="all"||n.movieId.toString()===S,Y=C==="all"||n.cinemaId.toString()===C;return t&&a&&g&&Y}),[o,u,y,S,C]),L=(n,t)=>{const a=o.map(g=>g.id===n?{...g,status:t,paymentStatus:t==="confirmed"?"paid":t==="cancelled"?"refunded":g.paymentStatus}:g);b(a),z.success(`Đã ${t==="confirmed"?"xác nhận":t==="cancelled"?"hủy":"cập nhật"} booking!`)},G=n=>{const t=o.filter(a=>a.id!==n);b(t),z.success("Xóa booking thành công!")},Q=n=>{const t=o.map(a=>a.id===i.id?{...a,...n}:a);b(t),v(!1),m(null),p.resetFields(),z.success("Cập nhật booking thành công!")},J=n=>{m(n),w(!0)},O=n=>{m(n),v(!0),p.setFieldsValue({status:n.status,paymentStatus:n.paymentStatus,paymentMethod:n.paymentMethod})},M=n=>{const t={confirmed:{color:"success",text:"Đã xác nhận",icon:e.jsx($,{})},pending:{color:"warning",text:"Chờ xử lý",icon:e.jsx(de,{})},cancelled:{color:"error",text:"Đã hủy",icon:e.jsx(he,{})},expired:{color:"default",text:"Hết hạn",icon:e.jsx(ce,{})}},a=t[n]||t.pending;return e.jsx(R,{color:a.color,icon:a.icon,children:a.text})},V=n=>{const t={paid:{color:"success",text:"Đã thanh toán"},pending:{color:"warning",text:"Chờ thanh toán"},failed:{color:"error",text:"Thanh toán thất bại"},refunded:{color:"default",text:"Đã hoàn tiền"}},a=t[n]||t.pending;return e.jsx(R,{color:a.color,children:a.text})},A=n=>({credit_card:"Thẻ tín dụng",bank_transfer:"Chuyển khoản",e_wallet:"Ví điện tử",cash:"Tiền mặt"})[n]||n,U=[{title:"ID",dataIndex:"id",key:"id",width:60,sorter:(n,t)=>n.id-t.id},{title:"Khách hàng",key:"customer",render:(n,t)=>e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:4},children:[e.jsx(F,{style:{marginRight:8}}),t.userName]}),e.jsx("div",{style:{color:"#666",fontSize:"12px"},children:t.customerInfo.email}),e.jsx("div",{style:{color:"#666",fontSize:"12px"},children:t.customerInfo.phone})]})},{title:"Phim",key:"movie",render:(n,t)=>e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:4},children:[e.jsx(te,{style:{marginRight:8}}),t.movieTitle]}),e.jsx("div",{style:{color:"#666",fontSize:"12px"},children:t.cinemaName})]})},{title:"Suất chiếu",key:"showtime",render:(n,t)=>e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:4},children:[e.jsx(B,{style:{marginRight:8}}),new Date(t.showtime).toLocaleDateString("vi-VN")]}),e.jsx("div",{style:{color:"#666",fontSize:"12px"},children:new Date(t.showtime).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})}),e.jsxs("div",{style:{color:"#666",fontSize:"12px"},children:[t.screening.room," - ",t.screening.format]})]})},{title:"Ghế",dataIndex:"seats",key:"seats",render:n=>e.jsx("div",{children:e.jsx(ne,{count:n.length,style:{backgroundColor:"#1890ff"},children:e.jsx("span",{children:n.join(", ")})})})},{title:"Tổng tiền",dataIndex:"totalPrice",key:"totalPrice",render:n=>e.jsxs("div",{style:{fontWeight:"bold",color:"#1890ff"},children:[e.jsx(_,{style:{marginRight:4}}),n?.toLocaleString("vi-VN")," ₫"]}),sorter:(n,t)=>n.totalPrice-t.totalPrice},{title:"Trạng thái",key:"status",render:(n,t)=>e.jsxs("div",{children:[M(t.status),e.jsx("br",{}),e.jsx("div",{style:{marginTop:4},children:V(t.paymentStatus)})]}),filters:[{text:"Đã xác nhận",value:"confirmed"},{text:"Chờ xử lý",value:"pending"},{text:"Đã hủy",value:"cancelled"},{text:"Hết hạn",value:"expired"}],onFilter:(n,t)=>t.status===n},{title:"Thao tác",key:"actions",width:200,render:(n,t)=>e.jsxs(f,{size:"small",direction:"vertical",children:[e.jsxs(f,{size:"small",children:[e.jsx(d,{type:"link",icon:e.jsx(se,{}),onClick:()=>J(t),size:"small",children:"Xem"}),e.jsx(d,{type:"link",icon:e.jsx(oe,{}),onClick:()=>O(t),size:"small",children:"Sửa"})]}),e.jsxs(f,{size:"small",children:[t.status==="pending"&&e.jsx(D,{title:"Xác nhận booking này?",onConfirm:()=>L(t.id,"confirmed"),okText:"Có",cancelText:"Không",children:e.jsx(d,{type:"link",size:"small",style:{color:"#52c41a"},children:"Xác nhận"})}),(t.status==="pending"||t.status==="confirmed")&&e.jsx(D,{title:"Hủy booking này?",onConfirm:()=>L(t.id,"cancelled"),okText:"Có",cancelText:"Không",children:e.jsx(d,{type:"link",danger:!0,size:"small",children:"Hủy"})}),e.jsx(D,{title:"Bạn có chắc chắn muốn xóa booking này?",onConfirm:()=>G(t.id),okText:"Có",cancelText:"Không",children:e.jsx(d,{type:"link",danger:!0,icon:e.jsx(re,{}),size:"small",children:"Xóa"})})]})]})}];return e.jsxs("div",{className:"bookings-container",children:[e.jsx("div",{className:"bookings-header",children:e.jsx("h1",{children:"Quản lý đặt vé"})}),e.jsxs(T,{gutter:[16,16],className:"stats-row",children:[e.jsx(r,{xs:24,sm:12,md:6,children:e.jsx(c,{children:e.jsx(k,{title:"Tổng booking",value:I.total,prefix:e.jsx(B,{}),valueStyle:{color:"#1890ff"}})})}),e.jsx(r,{xs:24,sm:12,md:6,children:e.jsx(c,{children:e.jsx(k,{title:"Đã xác nhận",value:I.confirmed,prefix:e.jsx($,{}),valueStyle:{color:"#52c41a"}})})}),e.jsx(r,{xs:24,sm:12,md:6,children:e.jsx(c,{children:e.jsx(k,{title:"Tổng doanh thu",value:I.totalRevenue,prefix:e.jsx(_,{}),suffix:"₫",formatter:n=>n.toLocaleString("vi-VN"),valueStyle:{color:"#faad14"}})})}),e.jsx(r,{xs:24,sm:12,md:6,children:e.jsx(c,{children:e.jsx(k,{title:"Tổng ghế đã bán",value:I.totalSeats,prefix:e.jsx(F,{}),valueStyle:{color:"#722ed1"}})})})]}),e.jsx(c,{className:"filter-card",children:e.jsxs(T,{gutter:[16,16],children:[e.jsx(r,{xs:24,md:6,children:e.jsx(Z.Search,{placeholder:"Tìm kiếm theo tên, email, phim...",value:u,onChange:n=>K(n.target.value),allowClear:!0})}),e.jsx(r,{xs:24,md:6,children:e.jsxs(x,{placeholder:"Lọc theo trạng thái",value:y,onChange:X,style:{width:"100%"},children:[e.jsx(l,{value:"all",children:"Tất cả trạng thái"}),e.jsx(l,{value:"confirmed",children:"Đã xác nhận"}),e.jsx(l,{value:"pending",children:"Chờ xử lý"}),e.jsx(l,{value:"cancelled",children:"Đã hủy"}),e.jsx(l,{value:"expired",children:"Hết hạn"})]})}),e.jsx(r,{xs:24,md:6,children:e.jsxs(x,{placeholder:"Lọc theo phim",value:S,onChange:W,style:{width:"100%"},children:[e.jsx(l,{value:"all",children:"Tất cả phim"}),ee.map(n=>e.jsx(l,{value:n.id.toString(),children:n.title},n.id))]})}),e.jsx(r,{xs:24,md:6,children:e.jsxs(x,{placeholder:"Lọc theo rạp",value:C,onChange:q,style:{width:"100%"},children:[e.jsx(l,{value:"all",children:"Tất cả rạp"}),ie.map(n=>e.jsx(l,{value:n.id.toString(),children:n.name},n.id))]})})]})}),e.jsx(c,{children:e.jsx(ae,{columns:U,dataSource:N,rowKey:"id",pagination:{total:N.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(n,t)=>`${t[0]}-${t[1]} của ${n} booking`},scroll:{x:1400}})}),e.jsx(P,{title:"Chỉnh sửa booking",open:H,onCancel:()=>{v(!1),m(null),p.resetFields()},footer:null,width:500,children:e.jsxs(j,{form:p,layout:"vertical",onFinish:Q,children:[e.jsx(j.Item,{name:"status",label:"Trạng thái booking",rules:[{required:!0,message:"Vui lòng chọn trạng thái!"}],children:e.jsxs(x,{placeholder:"Chọn trạng thái",children:[e.jsx(l,{value:"confirmed",children:"Đã xác nhận"}),e.jsx(l,{value:"pending",children:"Chờ xử lý"}),e.jsx(l,{value:"cancelled",children:"Đã hủy"}),e.jsx(l,{value:"expired",children:"Hết hạn"})]})}),e.jsx(j.Item,{name:"paymentStatus",label:"Trạng thái thanh toán",rules:[{required:!0,message:"Vui lòng chọn trạng thái thanh toán!"}],children:e.jsxs(x,{placeholder:"Chọn trạng thái thanh toán",children:[e.jsx(l,{value:"paid",children:"Đã thanh toán"}),e.jsx(l,{value:"pending",children:"Chờ thanh toán"}),e.jsx(l,{value:"failed",children:"Thanh toán thất bại"}),e.jsx(l,{value:"refunded",children:"Đã hoàn tiền"})]})}),e.jsx(j.Item,{name:"paymentMethod",label:"Phương thức thanh toán",rules:[{required:!0,message:"Vui lòng chọn phương thức thanh toán!"}],children:e.jsxs(x,{placeholder:"Chọn phương thức thanh toán",children:[e.jsx(l,{value:"credit_card",children:"Thẻ tín dụng"}),e.jsx(l,{value:"bank_transfer",children:"Chuyển khoản"}),e.jsx(l,{value:"e_wallet",children:"Ví điện tử"}),e.jsx(l,{value:"cash",children:"Tiền mặt"})]})}),e.jsx(j.Item,{children:e.jsxs(f,{children:[e.jsx(d,{type:"primary",htmlType:"submit",children:"Cập nhật"}),e.jsx(d,{onClick:()=>{v(!1),m(null),p.resetFields()},children:"Hủy"})]})})]})}),e.jsx(P,{title:"Chi tiết booking",open:E,onCancel:()=>{w(!1),m(null)},footer:[e.jsx(d,{onClick:()=>{w(!1),m(null)},children:"Đóng"},"close")],width:800,children:i&&e.jsxs("div",{children:[e.jsxs(T,{gutter:[24,16],children:[e.jsx(r,{span:12,children:e.jsx(c,{title:"Thông tin khách hàng",size:"small",children:e.jsxs(s,{column:1,size:"small",children:[e.jsx(s.Item,{label:"Tên",children:i.customerInfo.name}),e.jsx(s.Item,{label:"Email",children:i.customerInfo.email}),e.jsx(s.Item,{label:"Số điện thoại",children:i.customerInfo.phone})]})})}),e.jsx(r,{span:12,children:e.jsx(c,{title:"Thông tin đặt vé",size:"small",children:e.jsxs(s,{column:1,size:"small",children:[e.jsxs(s.Item,{label:"Mã booking",children:["#",i.id]}),e.jsxs(s.Item,{label:"Ngày đặt",children:[new Date(i.bookingDate).toLocaleDateString("vi-VN")," "," ",new Date(i.bookingDate).toLocaleTimeString("vi-VN")]}),e.jsx(s.Item,{label:"Trạng thái",children:M(i.status)})]})})})]}),e.jsxs(T,{gutter:[24,16],style:{marginTop:16},children:[e.jsx(r,{span:12,children:e.jsx(c,{title:"Thông tin phim",size:"small",children:e.jsxs(s,{column:1,size:"small",children:[e.jsx(s.Item,{label:"Phim",children:i.movieTitle}),e.jsx(s.Item,{label:"Rạp",children:i.cinemaName}),e.jsx(s.Item,{label:"Phòng chiếu",children:i.screening.room}),e.jsx(s.Item,{label:"Định dạng",children:i.screening.format}),e.jsx(s.Item,{label:"Ngôn ngữ",children:i.screening.language})]})})}),e.jsx(r,{span:12,children:e.jsx(c,{title:"Thông tin thanh toán",size:"small",children:e.jsxs(s,{column:1,size:"small",children:[e.jsx(s.Item,{label:"Phương thức",children:A(i.paymentMethod)}),e.jsx(s.Item,{label:"Trạng thái",children:V(i.paymentStatus)}),e.jsx(s.Item,{label:"Tổng tiền",children:e.jsxs("strong",{style:{color:"#1890ff",fontSize:"16px"},children:[i.totalPrice?.toLocaleString("vi-VN")," ₫"]})})]})})})]}),e.jsx(c,{title:"Chi tiết suất chiếu",size:"small",style:{marginTop:16},children:e.jsxs(s,{column:2,size:"small",children:[e.jsx(s.Item,{label:"Ngày chiếu",children:new Date(i.showtime).toLocaleDateString("vi-VN")}),e.jsx(s.Item,{label:"Giờ chiếu",children:new Date(i.showtime).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})}),e.jsx(s.Item,{label:"Ghế đã chọn",span:2,children:e.jsx(f,{wrap:!0,children:i.seats.map(n=>e.jsx(R,{color:"blue",children:n},n))})})]})})]})})]})};export{Ve as default};
