import{r as i,F as u,s as j,j as e,d as P,e as m,C as S,g as T,aI as te,f as p,M as $,I as ae,p as c,S as b,x as f,y as le}from"./index-bcuI966E.js";import{R as ne}from"./CheckCircleOutlined-Cm1v39Q0.js";import{R as oe}from"./CloseCircleOutlined-BOFOa5Iq.js";import{R as ie}from"./StopOutlined-YHg61arC.js";import{F as re}from"./Table-BovAFv33.js";import{R as ce}from"./PlusOutlined-WAyayBFJ.js";import{T as D}from"./index-CJAnxsAG.js";import{S as G}from"./index-COd8B_t3.js";import{A as de}from"./index-C2piJUMZ.js";import{R as he}from"./EditOutlined-ntD1OIry.js";import{R as ue}from"./DeleteOutlined-CNMFFws8.js";import"./addEventListener-CwuRzLNG.js";import"./DownOutlined-DeH2MZMn.js";import"./Pagination-KlOrN12m.js";const{Option:me}=G,Ie=()=>{const[d,x]=i.useState([]),[pe,O]=i.useState([]),[V,y]=i.useState(!1),[A,g]=i.useState(!1),[B,L]=i.useState(!1),[v,F]=i.useState(null),[k]=u.useForm(),[C,H]=i.useState(null),[N,E]=i.useState([]),[w,X]=i.useState({totalSeats:0,availableSeats:0,bookedSeats:0,blockedSeats:0}),I=[{value:"normal",label:"Ghế thường",color:"blue",price:7e4},{value:"vip",label:"Ghế VIP",color:"gold",price:1e5},{value:"couple",label:"Ghế đôi",color:"pink",price:15e4},{value:"premium",label:"Ghế Premium",color:"purple",price:12e4}];i.useEffect(()=>{q()},[]);const q=async()=>{try{y(!0);const s=await(await fetch("/src/data/seatData.json")).json(),n=await(await fetch("/src/data/cinemas.json")).json(),o=z(s.seats);x(o),O(n),K(s.seats)}catch(t){j.error("Lỗi khi tải dữ liệu ghế"),console.error("Error loading data:",t)}finally{y(!1)}},z=t=>{const s={};return t.forEach(a=>{const n=a.row.charAt(0);switch(s[n]||(s[n]={id:n,name:`Phòng ${n}`,totalSeats:0,availableSeats:0,bookedSeats:0,blockedSeats:0,seats:[]}),s[n].seats.push(a),s[n].totalSeats++,a.status){case"available":s[n].availableSeats++;break;case"booked":s[n].bookedSeats++;break;case"blocked":s[n].blockedSeats++;break}}),Object.values(s)},K=t=>{const s={totalSeats:t.length,availableSeats:t.filter(a=>a.status==="available").length,bookedSeats:t.filter(a=>a.status==="booked").length,blockedSeats:t.filter(a=>a.status==="blocked").length};X(s)},_=()=>{F(null),k.resetFields(),g(!0)},J=t=>{F(t),k.setFieldsValue({name:t.name,rows:Math.max(...t.seats.map(s=>s.row.charCodeAt(0)))-64,seatsPerRow:Math.max(...t.seats.map(s=>s.number))}),g(!0)},Q=t=>{H(t),E(M(t.seats)),L(!0)},M=t=>{const s={};return t.forEach(a=>{s[a.row]||(s[a.row]={}),s[a.row][a.number]=a}),s},U=async t=>{try{y(!0);const s=[],{name:a,rows:n,seatsPerRow:o,seatType:r="normal"}=t;for(let l=1;l<=n;l++){const h=String.fromCharCode(64+l);for(let R=1;R<=o;R++){const ee=I.find(se=>se.value===r);s.push({id:`${h}${R}`,row:h,number:R,type:r,status:"available",price:ee.price})}}if(v){const l=d.map(h=>h.id===v.id?{...h,name:a,seats:s,totalSeats:s.length}:h);x(l),j.success("Cập nhật phòng chiếu thành công")}else{const l={id:`P${d.length+1}`,name:a,totalSeats:s.length,availableSeats:s.length,bookedSeats:0,blockedSeats:0,seats:s};x([...d,l]),j.success("Tạo phòng chiếu thành công")}g(!1),k.resetFields()}catch(s){j.error("Có lỗi xảy ra khi lưu phòng chiếu"),console.error("Error saving room:",s)}finally{y(!1)}},W=t=>{$.confirm({title:"Xác nhận xóa",content:`Bạn có chắc chắn muốn xóa phòng "${t.name}"?`,okText:"Xóa",cancelText:"Hủy",okType:"danger",onOk:()=>{const s=d.filter(a=>a.id!==t.id);x(s),j.success("Xóa phòng chiếu thành công")}})},Y=(t,s,a)=>{const n=d.map(o=>{if(o.id===t){const r=o.seats.map(l=>l.id===s?{...l,status:a}:l);return{...o,seats:r,availableSeats:r.filter(l=>l.status==="available").length,bookedSeats:r.filter(l=>l.status==="booked").length,blockedSeats:r.filter(l=>l.status==="blocked").length}}return o});x(n),E(M(n.find(o=>o.id===t).seats))},Z=[{title:"Phòng chiếu",dataIndex:"name",key:"name",render:(t,s)=>e.jsxs(b,{children:[e.jsx("strong",{children:t}),e.jsxs(c,{color:"blue",children:["ID: ",s.id]})]})},{title:"Tổng số ghế",dataIndex:"totalSeats",key:"totalSeats",align:"center",render:t=>e.jsxs(c,{color:"blue",children:[t," ghế"]})},{title:"Trạng thái ghế",key:"status",render:(t,s)=>e.jsxs(b,{direction:"vertical",size:"small",children:[e.jsxs(c,{color:"success",children:["Trống: ",s.availableSeats]}),e.jsxs(c,{color:"error",children:["Đã đặt: ",s.bookedSeats]}),e.jsxs(c,{color:"warning",children:["Khóa: ",s.blockedSeats]})]})},{title:"Tỷ lệ lấp đầy",key:"occupancy",align:"center",render:(t,s)=>{const a=(s.bookedSeats/s.totalSeats*100).toFixed(1);return e.jsx(f,{title:`${s.bookedSeats}/${s.totalSeats} ghế đã đặt`,children:e.jsxs(c,{color:a>80?"red":a>50?"orange":"green",children:[a,"%"]})})}},{title:"Thao tác",key:"actions",align:"center",render:(t,s)=>e.jsxs(b,{children:[e.jsx(f,{title:"Xem layout",children:e.jsx(p,{icon:e.jsx(le,{}),onClick:()=>Q(s)})}),e.jsx(f,{title:"Chỉnh sửa",children:e.jsx(p,{icon:e.jsx(he,{}),onClick:()=>J(s)})}),e.jsx(f,{title:"Xóa",children:e.jsx(p,{icon:e.jsx(ue,{}),danger:!0,onClick:()=>W(s)})})]})}];return e.jsxs("div",{className:"seats-page",children:[e.jsxs(P,{gutter:16,style:{marginBottom:24},children:[e.jsx(m,{span:6,children:e.jsx(S,{children:e.jsx(T,{title:"Tổng số ghế",value:w.totalSeats,prefix:e.jsx(te,{}),valueStyle:{color:"#1890ff"}})})}),e.jsx(m,{span:6,children:e.jsx(S,{children:e.jsx(T,{title:"Ghế trống",value:w.availableSeats,prefix:e.jsx(ne,{}),valueStyle:{color:"#52c41a"}})})}),e.jsx(m,{span:6,children:e.jsx(S,{children:e.jsx(T,{title:"Ghế đã đặt",value:w.bookedSeats,prefix:e.jsx(oe,{}),valueStyle:{color:"#f5222d"}})})}),e.jsx(m,{span:6,children:e.jsx(S,{children:e.jsx(T,{title:"Ghế bị khóa",value:w.blockedSeats,prefix:e.jsx(ie,{}),valueStyle:{color:"#fa8c16"}})})})]}),e.jsx(S,{title:"Danh sách phòng chiếu",extra:e.jsx(p,{type:"primary",icon:e.jsx(ce,{}),onClick:_,children:"Tạo phòng mới"}),children:e.jsx(re,{columns:Z,dataSource:d,rowKey:"id",loading:V,pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`Tổng ${t} phòng`}})}),e.jsx($,{title:v?"Chỉnh sửa phòng chiếu":"Tạo phòng chiếu mới",open:A,onCancel:()=>g(!1),footer:null,width:600,children:e.jsxs(u,{form:k,layout:"vertical",onFinish:U,children:[e.jsx(u.Item,{name:"name",label:"Tên phòng",rules:[{required:!0,message:"Vui lòng nhập tên phòng"}],children:e.jsx(ae,{placeholder:"VD: Phòng A1, Rạp 1..."})}),e.jsxs(P,{gutter:16,children:[e.jsx(m,{span:12,children:e.jsx(u.Item,{name:"rows",label:"Số hàng ghế",rules:[{required:!0,message:"Vui lòng nhập số hàng"}],children:e.jsx(D,{min:1,max:20,placeholder:"VD: 10",style:{width:"100%"}})})}),e.jsx(m,{span:12,children:e.jsx(u.Item,{name:"seatsPerRow",label:"Số ghế mỗi hàng",rules:[{required:!0,message:"Vui lòng nhập số ghế mỗi hàng"}],children:e.jsx(D,{min:1,max:30,placeholder:"VD: 15",style:{width:"100%"}})})})]}),e.jsx(u.Item,{name:"seatType",label:"Loại ghế mặc định",initialValue:"normal",children:e.jsx(G,{children:I.map(t=>e.jsxs(me,{value:t.value,children:[e.jsx(c,{color:t.color,children:t.label}),e.jsxs("span",{style:{marginLeft:8},children:[t.price.toLocaleString("vi-VN"),"đ"]})]},t.value))})}),e.jsx(de,{message:"Lưu ý",description:"Sau khi tạo phòng, bạn có thể chỉnh sửa từng ghế trong phần xem layout.",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsxs(b,{style:{width:"100%",justifyContent:"flex-end"},children:[e.jsx(p,{onClick:()=>g(!1),children:"Hủy"}),e.jsx(p,{type:"primary",htmlType:"submit",loading:V,children:v?"Cập nhật":"Tạo phòng"})]})]})}),e.jsx($,{title:`Layout ghế - ${C?.name}`,open:B,onCancel:()=>L(!1),footer:null,width:900,bodyStyle:{maxHeight:"70vh",overflow:"auto"},children:C&&e.jsxs("div",{className:"seat-layout",children:[e.jsx("div",{className:"screen",children:e.jsx("div",{className:"screen-text",children:"MÀN HÌNH"})}),e.jsx("div",{className:"seat-grid",children:Object.keys(N).sort().map(t=>e.jsxs("div",{className:"seat-row",children:[e.jsx("div",{className:"row-label",children:t}),e.jsx("div",{className:"seats",children:Object.keys(N[t]).sort((s,a)=>Number(s)-Number(a)).map(s=>{const a=N[t][s],n=I.find(o=>o.value===a.type);return e.jsx(f,{title:`${a.id} - ${n.label} - ${a.price.toLocaleString("vi-VN")}đ`,children:e.jsx("div",{className:`seat ${a.status} ${a.type}`,onClick:()=>{const o=["available","booked","blocked"],r=o.indexOf(a.status),l=o[(r+1)%o.length];Y(C.id,a.id,l)},children:s})},a.id)})})]},t))}),e.jsx("div",{className:"seat-legend",children:e.jsxs(b,{children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"seat-demo available"}),e.jsx("span",{children:"Trống"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"seat-demo booked"}),e.jsx("span",{children:"Đã đặt"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"seat-demo blocked"}),e.jsx("span",{children:"Bị khóa"})]})]})})]})})]})};export{Ie as default};
