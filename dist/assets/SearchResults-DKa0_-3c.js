import{az as r,aA as A,Q as H,j as e,C as p,L as u,p as N,S as f,f as $,y as K,_ as E,aB as q,a as F,r as g,d as R,e as S,I as G,a7 as V,T as J,E as P}from"./index-bcuI966E.js";import{c as U}from"./cinemas-BvADCmeD.js";import{R as T}from"./index-Ciy63vs3.js";import{R as W}from"./SearchOutlined-D2gRiFxI.js";import{S as B}from"./index-COd8B_t3.js";import"./DownOutlined-DeH2MZMn.js";const X={async getAllMovies(){try{return(await r.get(A.MOVIES)).data}catch(s){return console.warn("API call failed, using local data:",s),H}},getMovies:async s=>r.get("/movies",{params:s}),getMovieById:async s=>r.get(`/movies/${s}`),createMovie:async s=>r.post("/movies",s),updateMovie:async(s,t)=>r.put(`/movies/${s}`,t),deleteMovie:async s=>r.delete(`/movies/${s}`)},Y={async getAllCinemas(){try{return(await r.get(A.CINEMAS)).data}catch(s){return console.warn("API call failed, using local data:",s),U}},getCinemas:async s=>r.get("/cinemas",{params:s}),getCinemaById:async s=>r.get(`/cinemas/${s}`),createCinema:async s=>r.post("/cinemas",s),updateCinema:async(s,t)=>r.put(`/cinemas/${s}`,t),deleteCinema:async s=>r.delete(`/cinemas/${s}`)},{Meta:Z}=p,ee=({movie:s,onTrailerClick:t,viewMode:C="grid"})=>{const{id:n,title:o,poster:l,rating:d,genre:m,releaseDate:h,ageLabel:i,duration:y,description:j}=s;return C==="list"?e.jsx(p,{className:"movie-card-list",hoverable:!0,bordered:!1,bodyStyle:{padding:0},children:e.jsxs("div",{className:"movie-card-list-content",children:[e.jsxs("div",{className:"movie-card-list-poster",children:[e.jsx(u,{to:`/movies/${n}`,children:e.jsx("img",{src:l,alt:o})}),i&&e.jsx(N,{className:"movie-age-label",color:"orange",children:i})]}),e.jsxs("div",{className:"movie-card-list-info",children:[e.jsxs("div",{className:"movie-card-list-header",children:[e.jsx(u,{to:`/movies/${n}`,className:"movie-title-link",children:e.jsx("h3",{className:"movie-title",children:o})}),e.jsxs(f,{children:[e.jsx(T,{disabled:!0,value:d/2,allowHalf:!0,size:"small"}),e.jsxs("span",{className:"movie-rating",children:[d,"/10"]})]})]}),e.jsx("div",{className:"movie-card-list-meta",children:e.jsxs(f,{wrap:!0,children:[m&&e.jsx(N,{color:"blue",children:m.split(", ")[0]}),y&&e.jsx("span",{className:"movie-duration",children:y}),h&&e.jsx("span",{className:"movie-release-date",children:h})]})}),j&&e.jsx("p",{className:"movie-description",children:j.length>120?`${j.substring(0,120)}...`:j}),e.jsx("div",{className:"movie-card-list-actions",children:e.jsxs(f,{children:[e.jsx(u,{to:`/movies/${n}`,children:e.jsx($,{type:"primary",icon:e.jsx(K,{}),children:"Chi tiết"})}),e.jsx($,{icon:e.jsx(E,{}),onClick:v=>{v.stopPropagation(),t?.(s)},children:"Trailer"})]})})]})]})}):e.jsx(p,{className:"movie-card-grid",hoverable:!0,bordered:!1,cover:e.jsxs("div",{className:"movie-card-cover",children:[e.jsx(u,{to:`/movies/${n}`,children:e.jsx("img",{alt:o,src:l})}),i&&e.jsx(N,{className:"movie-age-label",color:"orange",children:i}),e.jsx("div",{className:"movie-card-overlay",children:e.jsx($,{type:"primary",shape:"circle",size:"large",icon:e.jsx(E,{}),className:"movie-play-btn",onClick:v=>{v.stopPropagation(),t?.(s)}})})]}),bodyStyle:{padding:"16px"},children:e.jsx(Z,{title:e.jsx(u,{to:`/movies/${n}`,className:"movie-title-link",children:o}),description:e.jsxs("div",{className:"movie-card-grid-meta",children:[e.jsxs("div",{className:"movie-rating-row",children:[e.jsx(T,{disabled:!0,value:d/2,allowHalf:!0,size:"small"}),e.jsxs("span",{className:"movie-rating",children:[d,"/10"]})]}),e.jsx(f,{wrap:!0,size:[4,4],children:m&&m.split(", ").slice(0,2).map((v,w)=>e.jsx(N,{color:"blue",size:"small",children:v},w))}),h&&e.jsx("div",{className:"movie-release-date",children:h})]})})})},{Title:I,Text:z}=J,{Option:k}=B,ce=()=>{const[s,t]=q(),C=F(),[n,o]=g.useState(!1),[l,d]=g.useState(s.get("q")||""),[m,h]=g.useState(s.get("type")||"all"),[i,y]=g.useState({movies:[],cinemas:[],total:0});g.useEffect(()=>{const a=s.get("q"),x=s.get("type")||"all";a&&(d(a),h(x),j(a,x))},[s]);const j=async(a,x)=>{if(a.trim()){o(!0);try{const L=await X.getAllMovies(),Q=await Y.getAllCinemas();let b=[],M=[];(x==="all"||x==="movies")&&(b=L.filter(c=>c.title.toLowerCase().includes(a.toLowerCase())||c.genre.toLowerCase().includes(a.toLowerCase())||c.director.toLowerCase().includes(a.toLowerCase())||c.cast&&c.cast.some(_=>_.toLowerCase().includes(a.toLowerCase())))),(x==="all"||x==="cinemas")&&(M=Q.filter(c=>c.name.toLowerCase().includes(a.toLowerCase())||c.address.toLowerCase().includes(a.toLowerCase())||c.district.toLowerCase().includes(a.toLowerCase()))),y({movies:b,cinemas:M,total:b.length+M.length})}catch(L){console.error("Search error:",L)}finally{o(!1)}}},v=a=>{a.trim()&&t({q:a,type:m})},w=a=>{h(a),l&&t({q:l,type:a})},D=a=>{C(`/movies/${a}`)},O=a=>{C(`/cinemas/${a}`)};return e.jsxs("div",{className:"search-results-page",children:[e.jsx("div",{className:"search-header",children:e.jsxs(R,{gutter:[16,16],align:"middle",children:[e.jsx(S,{xs:24,md:16,children:e.jsx(G.Search,{placeholder:"Tìm kiếm phim, rạp chiếu...",value:l,onChange:a=>d(a.target.value),onSearch:v,size:"large",enterButton:e.jsx(W,{}),allowClear:!0})}),e.jsx(S,{xs:24,md:8,children:e.jsxs(B,{value:m,onChange:w,size:"large",style:{width:"100%"},children:[e.jsx(k,{value:"all",children:"Tất cả"}),e.jsx(k,{value:"movies",children:"Phim"}),e.jsx(k,{value:"cinemas",children:"Rạp chiếu"})]})})]})}),n?e.jsxs("div",{className:"search-loading",children:[e.jsx(V,{size:"large"}),e.jsx(z,{children:"Đang tìm kiếm..."})]}):e.jsxs("div",{className:"search-content",children:[l&&e.jsxs("div",{className:"search-info",children:[e.jsxs(I,{level:3,children:['Kết quả tìm kiếm cho "',l,'"']}),e.jsxs(z,{type:"secondary",children:["Tìm thấy ",i.total," kết quả"]})]}),i.total===0&&l?e.jsx(P,{description:"Không tìm thấy kết quả nào",image:P.PRESENTED_IMAGE_SIMPLE}):e.jsxs(e.Fragment,{children:[i.movies.length>0&&e.jsxs("div",{className:"search-section",children:[e.jsxs(I,{level:4,children:["Phim (",i.movies.length,")"]}),e.jsx(R,{gutter:[16,16],children:i.movies.map(a=>e.jsx(S,{xs:24,sm:12,md:8,lg:6,children:e.jsx(ee,{movie:a,onClick:()=>D(a.id)})},a.id))})]}),i.cinemas.length>0&&e.jsxs("div",{className:"search-section",children:[e.jsxs(I,{level:4,children:["Rạp chiếu (",i.cinemas.length,")"]}),e.jsx(R,{gutter:[16,16],children:i.cinemas.map(a=>e.jsx(S,{xs:24,sm:12,md:8,children:e.jsx(p,{hoverable:!0,className:"cinema-search-card",onClick:()=>O(a.id),children:e.jsx(p.Meta,{title:a.name,description:e.jsxs("div",{children:[e.jsx("div",{children:a.address}),e.jsx("div",{children:a.district}),e.jsxs("div",{children:[a.rooms?.length||0," phòng chiếu"]})]})})})},a.id))})]})]})]})]})};export{ce as default};
